# –ö–æ–¥ —Ä–µ–≤—å—é: Greek Quiz Bot

## –û–±—â–µ–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ

–ë–æ—Ç —Ö–æ—Ä–æ—à–æ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω –¥–ª—è —Å–≤–æ–µ–π —Ü–µ–ª–∏ ‚Äî –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ —ç–∫–∑–∞–º–µ–Ω—É A2. –ö–æ–¥ —á–∏—Ç–∞–µ—Ç—Å—è –ª–µ–≥–∫–æ, –ª–æ–≥–∏–∫–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ —Ä–∞–∑—É–º–Ω–æ. –ù–∏–∂–µ ‚Äî –∑–∞–º–µ—á–∞–Ω–∏—è –æ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–æ –∫–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∏—Ö.

---

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### 1. –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (`_save_all`, —Å—Ç—Ä–æ–∫–∏ 160‚Äì161)

```python
stats_ws.clear()          # ‚Üê –µ—Å–ª–∏ —Å–ª–µ–¥—É—é—â–∏–π –≤—ã–∑–æ–≤ —É–ø–∞–¥—ë—Ç...
stats_ws.update("A1", rows)  # ‚Üê –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–Ω–∏—á—Ç–æ–∂–µ–Ω—ã –Ω–∞–≤—Å–µ–≥–¥–∞
```

–ú–µ–∂–¥—É `clear()` –∏ `update()` –Ω–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏. –ï—Å–ª–∏ `update()` –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π (—Å–µ—Ç–µ–≤–æ–π —Å–±–æ–π, —Ç–∞–π–º–∞—É—Ç Google API), –ª–∏—Å—Ç Stats –æ–∫–∞–∂–µ—Ç—Å—è –ø—É—Å—Ç—ã–º ‚Äî –≤—Å–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä—è–Ω—ã –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ –∫–æ–¥–∞.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å–∞—Ç—å –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é ¬´–∑–∞–ø–∏—Å–∞—Ç—å ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å ‚Üí –æ—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä–æ–µ¬ª. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç ‚Äî –æ–±–µ—Ä–Ω—É—Ç—å –æ–±–∞ –≤—ã–∑–æ–≤–∞ –≤ `try/except` —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –Ω–µ —É–¥–∞–ª—è—Ç—å `user_sessions[user_id]` –ø—Ä–∏ –æ—à–∏–±–∫–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.

---

### 2. –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π backoff –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (—Å—Ç—Ä–æ–∫–∞ 531)

```python
await asyncio.sleep(2 ** attempt)  # attempt=0 ‚Üí sleep(1), attempt=1 ‚Üí sleep(2)
```

–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≥–æ–≤–æ—Ä–∏—Ç `# 1s, 2s`, –Ω–æ `2**0 = 1`, `2**1 = 2` ‚Äî —ç—Ç–æ –Ω–µ —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π backoff, –∞ –ª–∏–Ω–µ–π–Ω—ã–π —Ä–æ—Å—Ç. –≠—Ç–æ –Ω–µ –±–∞–≥ –≤ —Å—Ç—Ä–æ–≥–æ–º —Å–º—ã—Å–ª–µ, –Ω–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤–≤–æ–¥–∏—Ç –≤ –∑–∞–±–ª—É–∂–¥–µ–Ω–∏–µ. –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π backoff: `1s ‚Üí 2s ‚Üí 4s`.

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 3. –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Å—Å–∏–π —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ (—Å—Ç—Ä–æ–∫–∞ 433)

```python
user_sessions = {}
```

–ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ (–¥–µ–ø–ª–æ–π, –∫—Ä–∞—à, Heroku dynos recycling) –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–≤–∏–∑—ã —Ç–µ—Ä—è—é—Ç—Å—è. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏—Ç ¬´–°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞¬ª –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –Ω–∞—á–∞—Ç—ã–π –∫–≤–∏–∑.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–ª—è –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–µ—Å—Å–∏—é –≤ Redis –∏–ª–∏ –¥–∞–∂–µ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ª–∏—Å—Ç Google Sheets. –õ–∏–±–æ —è–≤–Ω–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —á—Ç–æ –∫–≤–∏–∑ –Ω—É–∂–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –∑–∞ –æ–¥–∏–Ω –ø—Ä–∏—Å–µ—Å—Ç.

### 4. –ù–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets –Ω–∞ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏

`_open_spreadsheet()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ (`_load_compact_data`, `_save_all`, `_load_history_for_stats`, `_clear_all`). –ö–∞–∂–¥—ã–π —Ä–∞–∑ —Å–æ–∑–¥–∞—é—Ç—Å—è –Ω–æ–≤—ã–µ `Credentials` –∏ –Ω–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ. –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∫–≤–∏–∑–∞ —ç—Ç–æ –º–∏–Ω–∏–º—É–º 2 –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø–æ–¥—Ä—è–¥.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í—ã–Ω–µ—Å—Ç–∏ `gspread.Client` –∫–∞–∫ –º–æ–¥—É–ª—å–Ω—ã–π singleton —Å –ª–µ–Ω–∏–≤–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –∏–ª–∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ `_save_all`.

### 5. –ó–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω–∞—è –¥–∞—Ç–∞ —ç–∫–∑–∞–º–µ–Ω–∞ –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö (—Å—Ç—Ä–æ–∫–∏ 376 –∏ 803)

```python
# build_prompt():
exam_date = datetime(2026, 5, 19)

# show_stats():
exam_date  = datetime(2026, 5, 19)
```

–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è. –ï—Å–ª–∏ –¥–∞—Ç–∞ –∏–∑–º–µ–Ω–∏—Ç—Å—è, –ª–µ–≥–∫–æ –∑–∞–±—ã—Ç—å –æ–±–Ω–æ–≤–∏—Ç—å –æ–¥–Ω–æ –∏–∑ –º–µ—Å—Ç.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```python
EXAM_DATE = datetime(2026, 5, 19)
```
‚Äî –≤—ã–Ω–µ—Å—Ç–∏ –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –º–æ–¥—É–ª—è —Ä—è–¥–æ–º —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞–º–∏.

---

## –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞

### 6. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –≤ –∫–∞–∂–¥–æ–º —Ö–µ–Ω–¥–ª–µ—Ä–µ

–ö–∞–∂–¥–∞—è –∏–∑ —Ñ—É–Ω–∫—Ü–∏–π `start`, `menu`, `quiz_command`, `reset_command`, `stats_command`, `handle_answer` —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –±–ª–æ–∫:

```python
if update.effective_user.username != ALLOWED_USERNAME:
    await update.message.reply_text("‚õî –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.")
    return
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í—ã–Ω–µ—Å—Ç–∏ –≤ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –∏–ª–∏ middleware:

```python
def require_auth(handler):
    async def wrapper(update: Update, context: ContextTypes.DEFAULT_TYPE):
        if update.effective_user.username != ALLOWED_USERNAME:
            await update.effective_message.reply_text("‚õî –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.")
            return
        return await handler(update, context)
    return wrapper

@require_auth
async def start(update, context): ...
```

### 7. –û—à–∏–±–∫–∏ –º–æ–ª—á–∞ –ø—Ä–æ–≥–ª–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö

```python
# —Å—Ç—Ä–æ–∫–∏ 488-490
try:
    await query.answer()
except Exception:
    pass  # ‚Üê —á—Ç–æ –∏–º–µ–Ω–Ω–æ —É–ø–∞–ª–æ ‚Äî –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ

# —Å—Ç—Ä–æ–∫–∞ 862
except Exception:
    pass  # —Ç–∏–ø —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ ‚Äî –±–æ–Ω—É—Å, –Ω–æ –æ–± –æ—à–∏–±–∫–µ –Ω–∏–∫—Ç–æ –Ω–µ —É–∑–Ω–∞–µ—Ç
```

–î–ª—è –ª–∏—á–Ω–æ–≥–æ –±–æ—Ç–∞ —ç—Ç–æ –ø—Ä–∏–µ–º–ª–µ–º–æ, –Ω–æ –ø—Ä–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ –ø—Ä–æ–±–ª–µ–º –ø—Ä–∏–¥—ë—Ç—Å—è –≥–∞–¥–∞—Ç—å. –•–æ—Ç—è –±—ã –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π `logging.warning(...)` —Å–ø–∞—Å –±—ã –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞:
```python
import logging
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)
```
–ò –∑–∞–º–µ–Ω–∏—Ç—å `pass` –Ω–∞ `logger.warning("...", exc_info=True)` –≤ –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Å—Ç–∞—Ö.

### 8. –ú–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞ –±–µ–∑ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Å—Ç–∞–Ω—Ç

```python
cutoff=0.6         # —Å—Ç—Ä–æ–∫–∞ 59 ‚Äî –ø–æ—Ä–æ–≥ —Å—Ö–æ–∂–µ—Å—Ç–∏ —Ç–æ–ø–∏–∫–∞
days_away >= 2     # —Å—Ç—Ä–æ–∫–∞ 369 ‚Äî –ø–æ—Ä–æ–≥ –¥–ª—è review_mode
days_left <= 30    # —Å—Ç—Ä–æ–∫–∞ 379 ‚Äî –ø–æ—Ä–æ–≥ –¥–ª—è pre-exam mode
pct < 60           # —Å—Ç—Ä–æ–∫–∏ 269, 350, 723 ‚Äî –≥—Ä–∞–Ω–∏—Ü–∞ —Å–ª–∞–±–æ–π —Ç–µ–º—ã
pct < 85           # —Å—Ç—Ä–æ–∫–∏ 270, 350 ‚Äî –≥—Ä–∞–Ω–∏—Ü–∞ —Å—Ä–µ–¥–Ω–µ–π —Ç–µ–º—ã
```

–ß–∏—Å–ª–∞ —Ä–∞–∑–±—Ä–æ—Å–∞–Ω—ã –ø–æ –∫–æ–¥—É. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å –ø–æ—Ä–æ–≥ ¬´—Å–ª–∞–±–æ–π —Ç–µ–º—ã¬ª ‚Äî –ø—Ä–∏–¥—ë—Ç—Å—è –∏—Å–∫–∞—Ç—å –≤—Å–µ –≤—Ö–æ–∂–¥–µ–Ω–∏—è.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```python
WEAK_THRESHOLD    = 60   # % –Ω–∏–∂–µ –∫–æ—Ç–æ—Ä–æ–≥–æ —Ç–µ–º–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Å–ª–∞–±–æ–π
MEDIUM_THRESHOLD  = 85   # % –≤—ã—à–µ –∫–æ—Ç–æ—Ä–æ–≥–æ —Ç–µ–º–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Å–∏–ª—å–Ω–æ–π
REVIEW_DAYS_GAP   = 2    # –¥–Ω–µ–π –±–µ–∑ –∑–∞–Ω—è—Ç–∏–π –¥–æ —Ä–µ–∂–∏–º–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è
PRE_EXAM_DAYS     = 30   # –¥–Ω–µ–π –¥–æ —ç–∫–∑–∞–º–µ–Ω–∞ –¥–ª—è pre-exam mode
TOPIC_MATCH_CUTOFF = 0.6 # –ø–æ—Ä–æ–≥ —Å—Ö–æ–∂–µ—Å—Ç–∏ –¥–ª—è difflib
```

### 9. –ù–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `_clear_all` (—Å—Ç—Ä–æ–∫–∏ 176‚Äì195)

–í —Ñ—É–Ω–∫—Ü–∏–∏ –æ—á–∏—Å—Ç–∫–∏ –æ—à–∏–±–∫–∏ –¥–ª—è History –∏ –¥–ª—è Stats/Sessions –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ-—Ä–∞–∑–Ω–æ–º—É: –¥–ª—è History ‚Äî `except Exception: pass` –±–µ–∑ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, –¥–ª—è Stats/Sessions ‚Äî —Ç–æ –∂–µ —Å–∞–º–æ–µ. –ï—Å–ª–∏ –æ—á–∏—Å—Ç–∫–∞ History —É–ø–∞–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ª–∏—Å—Ç –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç), —Ñ—É–Ω–∫—Ü–∏—è –≤–µ—Ä–Ω—ë—Ç `count = 0` –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–≤–∏–¥–∏—Ç ¬´–£–¥–∞–ª–µ–Ω–æ —Å—Ç—Ä–æ–∫: 0¬ª –±–µ–∑ –ø–æ–Ω–∏–º–∞–Ω–∏—è —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ.

---

## –ú–µ–ª–∫–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### 10. `send_question` –Ω–µ –∏–º–µ–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Å–µ—Å—Å–∏–∏

```python
async def send_question(message, user_id):
    session = user_sessions[user_id]  # ‚Üê KeyError –µ—Å–ª–∏ —Å–µ—Å—Å–∏—è –∏—Å—á–µ–∑–ª–∞
```

–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ `start_quiz` (–≥–¥–µ —Å–µ—Å—Å–∏—è —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–Ω–∞ ‚Äî –æ–∫) –∏ –∏–∑ `handle_answer` (–≥–¥–µ —É–∂–µ –µ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ ‚Äî –æ–∫). –ù–æ –µ—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –±—É–¥–µ—Ç —Ä–∞—Å—à–∏—Ä—è—Ç—å—Å—è, —ç—Ç–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –±–æ–º–±–∞.

### 11. –°—Ç—Ä–æ–∫–∞ 517: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ–±–µ—â–∞—é—Ç ~15 —Å–µ–∫—É–Ω–¥

```python
await message.reply_text("‚è≥ –ì–æ—Ç–æ–≤–ª—é –∫–≤–∏–∑... –≠—Ç–æ –∑–∞–π–º–µ—Ç –æ–∫–æ–ª–æ 15 —Å–µ–∫—É–Ω–¥.")
```

–í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ Claude API –∏ Sheets. –ü—Ä–∏ —Ç—Ä—ë—Ö –ø–æ–ø—ã—Ç–∫–∞—Ö —Å backoff —ç—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –¥–æ–ª—å—à–µ. –õ—É—á—à–µ –Ω–µ –Ω–∞–∑—ã–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–∏—Ñ—Ä—ã.

### 12. `h()` ‚Äî –Ω–µ–æ—á–µ–≤–∏–¥–Ω–æ–µ –∏–º—è —Ñ—É–Ω–∫—Ü–∏–∏ (—Å—Ç—Ä–æ–∫–∞ 63)

```python
def h(text):
    return html.escape(str(text))
```

–§—É–Ω–∫—Ü–∏—è –¥–µ–ª–∞–µ—Ç –≤–∞–∂–Ω–æ–µ –¥–µ–ª–æ (–∑–∞—â–∏—Ç–∞ –æ—Ç HTML-–∏–Ω—ä–µ–∫—Ü–∏–π –≤ Telegram), –Ω–æ –∏–º—è `h` –Ω–∏—á–µ–≥–æ –Ω–µ –≥–æ–≤–æ—Ä–∏—Ç. `escape_html` –∏–ª–∏ `esc` –±—ã–ª–æ –±—ã –ø–æ–Ω—è—Ç–Ω–µ–µ.

### 13. `normalize_topic` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—à—Ç—É—á–Ω–æ, –Ω–µ –ø–∞–∫–µ—Ç–æ–º (—Å—Ç—Ä–æ–∫–∞ 421)

```python
for q in questions:
    q["topic"] = normalize_topic(q["topic"])
```

–í–Ω—É—Ç—Ä–∏ `normalize_topic` `MASTER_TOPICS` –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ `difflib.get_close_matches` –Ω–∞ –∫–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, —Ç.–∫. —Å–ø–∏—Å–æ–∫ –º–∞–ª–µ–Ω—å–∫–∏–π (21 —ç–ª–µ–º–µ–Ω—Ç). –ù–æ –µ—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –≤—ã—Ä–∞—Å—Ç–µ—Ç, —Å—Ç–æ–∏—Ç –ø—Ä–µ–¥–≤—ã—á–∏—Å–ª–∏—Ç—å —á—Ç–æ-—Ç–æ.

---

## –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ —Ö–æ—Ä–æ—à–æ

- **Prompt caching**: –≥—Ä–∞–º–æ—Ç–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Å—Ç–∞—Ç–∏—á–Ω—ã–π –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–º–ø—Ç—ã —ç–∫–æ–Ω–æ–º–∏—Ç ~80% —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤—ã–∑–æ–≤–∞—Ö.
- **–¢—Ä–∏ –ª–∏—Å—Ç–∞ Google Sheets**: —É–º–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ ‚Äî Stats –∏ Sessions O(N —Ç–æ–ø–∏–∫–æ–≤), History –¥–ª—è –∞—É–¥–∏—Ç–∞ –æ—Ç–¥–µ–ª—å–Ω–æ.
- **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º —á–µ—Ä–µ–∑ difflib**: –ø—Ä–∞–∫—Ç–∏—á–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—Ä–µ–π—Ñ–∞ –∏–º—ë–Ω —Ç–æ–ø–∏–∫–æ–≤.
- **–ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π `query.answer()`**: –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ Telegram callback timeout.
- **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∫–≤–∏–∑**: –ª–æ–≥–∏–∫–∞ üî¥üü°üü¢‚ö™ —Ö–æ—Ä–æ—à–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ –ø—Ä–æ–º–ø—Ç–µ.
- **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥–µ**: —Å–µ–∫—Ü–∏–∏ –∏ docstring –æ–±—ä—è—Å–Ω—è—é—Ç –Ω–µ—Ç—Ä–∏–≤–∏–∞–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è.

---

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

| # | –ü—Ä–æ–±–ª–µ–º–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|---|----------|-----------|
| 1 | –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö Stats –º–µ–∂–¥—É `clear()` –∏ `update()` | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| 5 | –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ `EXAM_DATE` | üü° –õ–µ–≥–∫–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å |
| 6 | –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞ | üü° –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ |
| 7 | –ú–æ–ª—á–∞—â–∏–µ `except Exception: pass` | üü° –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ |
| 8 | –ú–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞ | üü¢ –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å |
| 4 | –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è Sheets | üü¢ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å |
| 3 | –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–π | üü¢ UX (–¥–ª—è –ª–∏—á–Ω–æ–≥–æ –±–æ—Ç–∞ –Ω–µ —Å—Ä–æ—á–Ω–æ) |
